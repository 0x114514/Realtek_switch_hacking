# RTL8367N 芯片的改造  

RTL8367N 应该算是现在主流的 5 口千兆交换机方案。把它当作 5 口的 RTL8370N 就好。  
使用这个芯片的最知名的机器可能是网件的 GS105E v2 版。GS105E v2 的固件也没有做出什么限制，直接可刷，还有配套的管理软件。。  

## 原料 

淘宝搜索 “铁壳5口千兆交换机”，会有一款在图片上自称“网络通讯专家”，大概 48 块左右不包邮的机器。里面大概长这样。  
![full](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8367n-full.png)

| 原料 | 备注（数量？ |
|---|---|
|铁壳5口千兆交换机|1|
|22Ω 0402*4 排阻|1|
|4.7kΩ 0402 贴片电阻|4|
|4.7kΩ 0805 贴片电阻|1| 
|470Ω  0805 贴片电阻|1|
|0.1uF 0402 贴片电容|1|
|25q80 1Mbyte SPI Flash|1|

## 原理图
原理图自己去手册里找，手册在本 Repo 找（   
改法和 SP-08 一样，主要就是补全 SPI 相关电路和更改启动设置。见 Datasheet。 

## 改法 
补齐 SPI Flash 电路：焊 1 个排阻， 4 个 4.7k 的上拉电阻， 1 个 104 电容（下图中没焊，就是空着的那个）到对应的位置即可。  
SPI Flash 写好固件焊上去。原机焊盘不够位置，可以压一压再焊上去。。    
![todo](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8367n-todo.png)  
![en_spif](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8367n-dis_8051.png)  


改启动：  
1. 移动 PIN 69，DIS_8051 相连的电阻到旁边的另一个位置。  
2. 拆掉 PORT 3 的 LED，有四个并排的电阻，靠 PORT 4 的那个电阻拆下来换成 4.7k 0805，一端焊到旁边 +3.3V，另一端焊到原电阻远离主芯片一侧；  
靠 PORT 2 的那个电阻换成 470 0805，同样一端焊到旁边 +3.3V，另一端焊到原电阻远离主芯片一侧。  
然后把 P3LED0 所控制的 LED 拆下来，拔出来，转 180°，插回去，焊回去。  
写起来好麻烦看图吧（  

然后记得移除 PIN 54，GPIO01 / UART_RX 那条线连接的下拉电阻。那个是被固件当成复位的，不移除就无法开机了。。当然你也可以引个开关出来。    


另：推荐换掉原机的 3 个电解电容，我在立创买过的 Rubycon 电解电容 可不是这感觉的。= =  


## 固件
你可以通过网件的下载中心获取，将 Bootloader 写入 0x0， 固件本体写入 0x1D000，MAC 地址写到 0xFC000 即可。  
然后下载网件的 ProSAFE Plus Utility 软件，如果你改造成功的话，按照他们的文档，软件可以搜索到交换机，并且提示你升级固件。按提示上传固件即可。  
刷好会自动重启，建议先清一下配置。  
如果你觉得麻烦，也可以用我备份的 bin 文件，但是记得改 MAC。

## 其他注意事项
同一个广播域下用一台以上的这种改后的机器，一定记得改 MAC ，MAC 在 0xFC000 处。  
复位键接的是 PIN 54，GPIO01/UART_RX，接个开关串电阻到地就是复位键了。  


## 最后。。
本方法仅用作学习交流，成功后 24 小时内请拆掉。（
