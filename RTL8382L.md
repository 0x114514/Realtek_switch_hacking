## RTL8382L + RTL8218B + RTL8231 方案

这个方案内置一个 MIPS 4KEc 内核，可能因为种种考虑导致 SG116M v1 这种 159 包邮低端车都得使用 SPI Flash 启动。。  
所以改造也很简单，如 SG116M v1，不需要补齐周边电路了，只要改下复位键电路就好了。  

现在的问题是：
  1. LED 完全不正常，无力逆向控制 RTL8231 的代码。。  
  2. 不确定自己拼装的固件结构是否正确，因为前面 32k 只用到了很少一部分（0x690），原厂在这里肯定是存了点什么东西但是没钱买没法确定。。  

另楼主是被 Lean 忽悠上车的，差点翻了。。= =  


## 硬件改造

拆机的时候注意，全机唯一一个螺丝在背面贴纸下，位置很奇怪。。。多摸摸。。。。  

这次的硬件改造异常简单，首先拆掉大块的散热片，因为焊盘没有接地，很好拆。  
  
![主芯片](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8382l-sg116m-full.png)  

拆掉原机的 Flash，换个写好固件的 25q80 即可。我用的 GD25Q80 没问题。  

![Flash](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8382l-flash.png)  

然后对于复位键，将 RTL8382L 芯片右上角离芯片最近的空焊盘 （GPIO 3）用一个 4.7k 电阻上拉到 3.3V 即可。  
我这里使用了一个 0603 的贴片电阻，刚好可以搭到旁边的 DVDDH 电源脚的电容上。    
下图为需要加电阻的两点。  

![加电阻位置](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8382l-add-res.png)  

下图为加完的样子。（忽略那堆热熔胶）  

![加完电阻的](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/8382l-add-res-after.png)

确定连接无误即可上电。  

如果需要引出恢复出厂设置的开关，可以参考这个图连接。电路图上的 R1 就是补焊的那个电阻，只需要额外买个微动开关即可。  
![reset-key](https://github.com/libc0607/RTL8370N_switch_hacking/blob/master/pic/sg116m-reset-key.png)

## 关于固件 

这个系列的固件猜测是 U-Boot 改的，看到里面一些谜之字段还没被去掉。另外根据网上找到的一些代码猜测这个应该是 2011.12 版的 U-Boot。  

MAC 地址位置请 WinHex 手动搜索 16 进制 0012345678ab，替换即可。不要替换 0xFE000 后的配置区中的地址，他们在启动的时候应该是做了配置校验的。  

RTL8382L 仅有 UART0，SG116M 的固件波特率 115200，支持读取一些寄存器的简单命令。  
这个管理固件的波特率是 38400，但不知道为什么除了初始化信息什么都没有。。也许有些开关之类的（？）  

本固件仅供学习交流嵌入式技术，请不要随意扩散/商用，如有侵权请联系我删除。  
